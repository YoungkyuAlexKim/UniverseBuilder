"""
설정 값들을 중앙에서 관리하는 모듈
"""
from typing import List
from dataclasses import dataclass, field


@dataclass
class AIModels:
    """AI 모델 관련 설정"""
    available: List[str] = field(default_factory=lambda: [
        "gemini-2.5-flash-lite",
        "gemini-2.5-flash"
    ])
    default: str = "gemini-2.5-flash-lite"


@dataclass
class AIPrompts:
    """AI 프롬프트 템플릿"""
    worldview_new: str = """당신은 상상력이 매우 풍부한 세계관 기획 전문가입니다.
사용자가 제공한 '핵심 키워드'를 바탕으로, 독창적이고 흥미로운 가상의 세계관의 기본 설정을 구체적으로 작성해주세요.
**매우 중요한 규칙:**
1.  결과는 반드시 '출력 항목 예시'에 명시된 5가지 항목(세계의 이름과 분위기, 핵심 설정, 주요 역사, 지배 세력, 주요 갈등)을 모두 포함해야 합니다.
2.  다른 어떤 설명도 추가하지 말고, 생성된 세계관 설정 텍스트 본문만 응답해야 합니다.
---
[핵심 키워드]
"{keywords}"
---
[출력]
(당신이 창조한 새로운 세계관 설정)
"""

    worldview_edit: str = """당신은 세계관 설정의 일관성을 유지하는 전문 편집자입니다.
아래에 제공된 '기존 세계관 설정'을 바탕으로, 사용자의 '요청사항'을 반영하여 설정을 수정하거나 확장하는 임무를 받았습니다.
**매우 중요한 규칙:**
1.  **'기존 세계관 설정'의 구조, 문체, 핵심 용어 등을 반드시 유지해야 합니다.**
2.  사용자의 '요청사항'은 기존 설정에 자연스럽게 녹아들도록 추가하거나, 기존 내용의 일부를 논리적으로 수정하는 방식으로 반영해야 합니다.
3.  최종 결과물은 **완성된 전체 세계관 텍스트**여야 합니다. 추가된 부분만 응답해서는 안 됩니다.
---
[기존 세계관 설정]
{existing_content}
---
[사용자 요청사항]
"{keywords}"
---
[출력]
(수정/확장된 전체 세계관 텍스트)
"""

    character_generation: str = """당신은 매력적인 스토리를 만드는 세계관 설정 작가입니다.
아래 '정보'와 '지시사항'을 모두 종합적으로 고려하여, 이 세계에 자연스럽게 녹아들 수 있는 새로운 판타지 캐릭터 카드 1개를 생성해 주세요.
{worldview_context}
{worldview_cards_context}
{character_context}
**요청 키워드:** {keywords}
**매우 중요한 규칙:**
1.  **HTML 태그는 절대 사용하지 말고, 순수한 텍스트로만 응답해야 합니다.**
2.  결과는 반드시 아래 명시된 JSON 스키마를 따르는 JSON 객체로만 응답해야 합니다. 다른 어떤 텍스트도 포함하지 마세요.
**출력 JSON 스키마:**
{{
  "name": "캐릭터 이름",
  "description": "캐릭터의 외모, 성격, 배경 이야기 (순수 텍스트).",
  "goal": ["캐릭터의 목표 또는 동기 1", "캐릭터의 목표 또는 동기 2"],
  "personality": ["성격 키워드 1", "성격 키워드 2"],
  "abilities": ["보유 기술 또는 능력 1", "보유 기술 또는 능력 2"],
  "quote": ["캐릭터를 대표하는 대사 1", "캐릭터를 대표하는 대사 2", "캐릭터를 대표하는 대사 3", "캐릭터를 대표하는 대사 4", "캐릭터를 대표하는 대사 5"],
  "introduction_story": "등장 서사 (순수 텍스트)."
}}
"""

    character_edit: str = """당신은 세계관 설정의 일관성을 유지하는 전문 편집자입니다.
아래에 제공되는 '프로젝트 데이터'와 '사용자 요청사항'을 바탕으로 캐릭터 카드 정보를 수정해주세요.
**매우 중요한 규칙:**
1.  **HTML 태그는 절대 사용하지 말고, 순수한 텍스트로만 응답해야 합니다.**
2.  {editing_instruction}
3.  'quote', 'personality', 'abilities', 'goal' 항목은 반드시 **배열(리스트)** 형태로 반환해야 합니다.
4.  절대로 기존 카드의 'id'는 변경해서는 안 됩니다.
5.  최종 결과는 반드시 아래 명시된 JSON 형식으로만 반환해야 합니다.
---
[프로젝트 데이터 (사용자가 선택한 일부)]
{full_project_context}
---
[사용자 요청사항]
"{prompt_text}"
---
[출력 JSON 형식]
{{
  "updated_cards": [
    {{
      "id": "수정된 카드의 id",
      "name": "새로운 이름 (변경 시)",
      "description": "새로운 설명 (순수 텍스트)",
      "goal": ["새로운 목표 1"],
      "personality": ["새로운 성격 키워드 1"],
      "abilities": ["새로운 기술 또는 능력 1"],
      "quote": ["새로운 대사 1"],
      "introduction_story": "새로운 서사 (순수 텍스트)"
    }}
  ]
}}
"""

    worldview_card_edit: str = """당신은 세계관 설정의 일관성을 유지하는 전문 편집자입니다.
아래 정보를 바탕으로 **세계관 설정 카드**의 내용을 수정해주세요.
**매우 중요한 규칙:**
1.  {editing_instruction}
2.  절대로 기존 카드의 'id'는 변경해서는 안 됩니다.
3.  최종 결과는 반드시 아래 명시된 JSON 형식으로만 반환해야 합니다.
---
[메인 세계관 정보]
{main_worldview_context}
---
[관련 설정 카드 정보 (JSON)]
{worldview_cards_json}
---
[사용자 요청사항]
"{prompt_text}"
---
[출력 JSON 형식]
{{
  "updated_cards": [
    {{
      "id": "수정된 카드의 id",
      "title": "새로운 제목 (변경 시)",
      "content": "새로운 내용 (순수 텍스트)"
    }}
  ]
}}
"""

    scenario_draft: str = """[SYSTEM INSTRUCTION]
당신은 'Universe Builder' 시스템의 일부로 동작하는, JSON 형식의 플롯 생성 전문 AI입니다.
당신의 유일한 임무는 주어진 [CONTEXT]를 바탕으로, [TASK]에 명시된 규칙을 완벽하게 준수하여 JSON 응답을 생성하는 것입니다.
절대로 설명, 사과, 추가 텍스트를 포함해서는 안 됩니다. 오직 유효한 JSON 객체만을 출력해야 합니다.

[CONTEXT]
{worldview_rules_context}
{story_genre_context}
{scenario_themes}
{characters_context}
{story_concept}
{prologue_context}
---

[TASK]
1. [CONTEXT]의 모든 정보를 종합하여, 고전적인 3막 구조를 따르는 흥미로운 플롯 아웃라인을 생성하세요.
2. 플롯은 정확히 {plot_point_count}개의 포인트로 구성되어야 합니다.
3. 최종 결과물은 반드시 아래 JSON 스키마를 따르는 단 하나의 JSON 객체여야 합니다.
4. 만약 어떤 이유로든 생성이 불가능하다면, `{{ "plot_points": [] }}` 를 출력하세요.

[CONTENT GUIDELINE]
- 스토리는 전개상 필요하다면 복잡하고 성숙한 주제(예: 사랑, 복수, 갈등, 배신, 희생 등)를 다룰 수 있습니다. 불필요하게 잔인하거나 노골적인 성적 묘사는 피하고, 주제를 상징적이고 은유적으로 표현해주세요.

**JSON 스키마:**
{{
  "plot_points": [
    {{
      "title": "플롯 포인트의 간결한 제목",
      "content": "이 플롯 포인트에서 발생하는 핵심 사건, 등장인물의 감정 변화, 그리고 다음 사건으로 이어지는 단서를 포함한 상세한 설명."
    }}
  ]
}}

---
[CRITICAL FINAL INSTRUCTION]
Your entire response must start with `{{` and end with `}}`. No other text, explanation, or formatting is permitted.
"""

    scenario_concept_refine: str = """당신은 사용자의 아이디어를 존중하며 글을 다듬는 전문 스토리 에디터입니다.
아래 정보를 바탕으로, '기존 컨셉'의 핵심 아이디어와 뉘앙스를 **반드시 유지**하면서, 문장을 더욱 생생하고 구체적으로 다듬어 주세요.
{worldview_context}

**매우 중요한 규칙:**
1.  **세계관 일관성:** 다듬어진 문장은 반드시 '메인 세계관'의 설정과 충돌해서는 안 됩니다.
2.  **핵심 의도와 감성 유지:** 원본 문장이 가진 고유의 감성(예: 희망, 비극, 유머 등)과 핵심 의도를 변경해서는 안 됩니다. 문장을 확장하고 구체화하되, 완전히 다른 이야기로 바꾸지 마세요.
3.  추상적인 표현을 구체적인 상황이나 감정이 드러나도록 풍부하게 만들어 주세요.
4.  최종 결과는 **오직 다듬어진 한두 문장, 혹은 두세 문장의 컨셉 텍스트**여야 합니다. 다른 설명을 붙이지 마세요.

---
[기존 컨셉]
{existing_concept}
---
[출력]
(AI가 핵심 뉘앙스와 세계관을 유지하며 다듬은 새로운 컨셉)
"""

    worldview_rule_refine: str = """당신은 사용자의 아이디어를 존중하며 문장을 다듬는 전문 에디터입니다.
아래 정보를 바탕으로, '기존 설정 문장'의 핵심 아이디어와 뉘앙스를 **반드시 유지**하면서, 문장을 더욱 흥미롭고 구체적으로 다듬어 주세요.

{worldview_context}

**매우 중요한 규칙:**
1.  **일관성 유지:** 다듬어진 문장은 '메인 세계관 정보'와 충돌해서는 안 됩니다.
2.  **핵심 의도 유지:** 원본 문장이 가진 핵심 의미를 변경하지 마세요. 문장을 확장하고 구체화하되, 완전히 다른 내용으로 바꾸지 마세요.
3.  최종 결과는 **오직 다듬어진 한 문장의 텍스트**여야 합니다. 다른 설명을 붙이지 마세요.

---
[기존 설정 문장]
{existing_rule}
---
[출력]
(AI가 핵심 뉘앙스와 세계관을 유지하며 다듬은 새로운 문장)
"""

    relationship_suggestion: str = """당신은 두 인물 사이의 관계를 창의적으로 설정하는 스토리 작가입니다.
아래 제공된 두 캐릭터의 프로필과 기존 관계 정보를 자세히 분석하여, 둘 사이에 존재할 법한 가장 흥미롭고 개연성 있는 관계를 추천해주세요.
**매우 중요한 규칙:**
1.  결과는 반드시 아래 명시된 JSON 스키마를 따르는 JSON 객체로만 응답해야 합니다.
2.  'type'에는 관계를 한두 단어로 요약한 키워드를, 'description'에는 그 관계에 대한 2~3문장의 구체적인 설명을 작성해주세요.
3.  **생성되는 관계 설명은 반드시 '캐릭터 A'와 '캐릭터 B' 두 사람 사이의 직접적인 이야기에만 집중해야 합니다.**
4.  {final_instruction}
{existing_relationship_context}
---
[캐릭터 A 프로필 ({char_a_name})]
- 설명: {char_a_description}
- 목표: {char_a_goals}
- 성격: {char_a_personality}
[캐릭터 B 프로필 ({char_b_name})]
- 설명: {char_b_description}
- 목표: {char_b_goals}
- 성격: {char_b_personality}
---
**출력 JSON 스키마:**
{{
  "type": "관계 유형 (예: 숙명의 라이벌)",
  "description": "관계에 대한 구체적인 설명 (2~3 문장)."
}}
"""

    plot_point_edit: str = """당신은 이야기의 전체적인 일관성을 유지하며 특정 부분을 섬세하게 수정하는 전문 스토리 편집자입니다.
아래 제공된 '전체 스토리 흐름'과 컨텍스트를 참고하여, '수정 대상 플롯 포인트'를 사용자의 '수정 요청사항'에 맞게 수정해주세요.

{story_concept}
{prologue_context}
[주요 등장인물]
{characters_context}

[전체 스토리 흐름]
{full_story_context}
---
[수정 대상 플롯 포인트]
- 제목: {plot_title}
- 내용: {plot_content}

[사용자 수정 요청사항]
"{user_prompt}"
---
**매우 중요한 규칙:**
1.  **오직 '수정 대상 플롯 포인트'의 제목과 내용만** 수정해야 합니다.
2.  수정된 내용은 '전체 스토리 흐름'의 맥락과 자연스럽게 연결되어야 합니다.
3.  결과는 반드시 아래 명시된 JSON 스키마 형식으로만 응답해야 합니다.
4.  **만약 어떤 이유로든 수정에 실패할 경우, 오류 메시지 대신 원본 제목과 내용을 담은 유효한 JSON을 반환해야 합니다.** 이 규칙은 절대적입니다.

**출력 JSON 스키마:**
```json
{{
  "title": "새롭게 수정된 플롯 제목",
  "content": "새롭게 수정된 플롯 내용 (2~3 문장)"
}}
```
"""


# 설정 인스턴스 생성
ai_models = AIModels()
ai_prompts = AIPrompts()
